import { Component, OnInit, ViewChild } from '@angular/core';
import { Competence } from '../../classe/competence';
import { CompetenceService } from '../../service/competence.service';
import { Router } from '@angular/router';
import { EditCompetenceComponent } from '../../edit/edit-competence/edit-competence.component';

const cpt1: Competence = {id: 1, nom: 'Java', domaine: 'Technique'};

const cpt2: Competence = {id: 2, nom: 'C', domaine: 'Technique'};

  @Component({
  selector: 'app-display-competence',
  templateUrl: './display-competence.component.html',
  styleUrls: ['./display-competence.component.css'],
  providers: [CompetenceService]
})
export class DisplayCompetenceComponent implements OnInit {

  competences: Competence[] = [];
  selectedCompetence: Competence;
  isSelected: boolean;
  @ViewChild(EditCompetenceComponent, {static: false}) ecc: EditCompetenceComponent;

  constructor(private compService: CompetenceService, private router: Router) { }


  ngOnInit() {
    this.compService.getAll().subscribe((c) => this.competences = c);
    this.competences.push(cpt1,cpt2)
    console.log(this.competences);
  }


  onSelect(competence: Competence): void {
    this.selectedCompetence = competence;
    this.isSelected = true;
  }

  edit(): void {
    this.ecc.passData(this.selectedCompetence);
    this.router.navigate(['/editCompetence']);
  }

  clear(): void {
    this.compService.clear().subscribe();
  }

  create(competence: Competence): void {
    this.compService.create(competence).subscribe((competencec) => this.competences.push(competencec));
  }

  delete(id: number): void {
    this.competences = this.competences.filter((c) => c.id !== id);
    this.compService.delete(id).subscribe();
  }

  getCompetences(): void {
    this.compService.getAll()
    .subscribe((competences) => this.competences = competences);
  }

  getById(id: number): void {
    this.compService.getById(id).subscribe((competence) => this.competences.push(competence));
  }

  update(competence: Competence): void {
    this.competences = this.competences.filter((c) => c.id !== competence.id);
    this.competences.push(competence);
    this.compService.update(competence).subscribe();
  }

  getByDomaine(nom: string): void {
  this.compService.getByDomaine(nom).subscribe((competences) => this.competences = competences);
  }

  getByNom(nom: string): void {
    this.compService.getByNom(nom).subscribe((competence) => this.competences.push(competence));
  }

  getByEquipe(nom: string): void {
    this.compService.getByEquipe(nom).subscribe((competences) => this.competences = competences);
  }

  getByRessource(nom: string, prenom: string): void {
    this.compService.getByRessource(nom, prenom).subscribe((competences) => this.competences = competences);
  }

  getByRessourceAndNiveau(nom: string, prenom: string, niveau: number, orgnom: string): void {
    this.compService.getByRessourceAndNiveau(nom, prenom, niveau, orgnom).subscribe((competences) => this.competences = competences);
  }

  getByEquipeAndNiveau(nom: string, niveau: number, orgnom: string): void {
    this.compService.getByEquipeAndNiveau(nom, niveau, orgnom).subscribe((competences) => this.competences = competences);
  }

}
